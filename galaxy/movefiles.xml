<?xml version="1.0" encoding="UTF-8"?>
<tool id="test" name="Test" version="1.4.8">
    <description>Test - split genome file</description>

    <requirements>
        <!-- Container -->
        <container type="docker">avohcemm/biomarkersearch-mod1to6:galaxytool_2</container>
    </requirements>

    <command><![CDATA[
    mkdir -p working_dir &&

    { cp "${genomeinfo}" genome.csv 2> debug_files_upload.txt && echo "Genome Info Copy succeeded"; } || { echo "Genome Info Copy failed"; script_exit_code=1; } && 
    { grep -q ',' genome.csv && echo "CVS comma separated format check passed"; } || { echo "Error: Genome Info file is not in csv format (missing ',' separator)"; script_exit_code=1; } && [ \$script_exit_code -eq 0 ] && mkdir -p chromosomes && awk -F',' '{print $1 > "chromosomes/"$1".txt"}' genome.csv && echo "Chromosome label files created in chromosomes" &&
    ls -lh chromosomes >> debug_files_upload.txt

    ]]></command>

     <environment_variables>
        <environment_variable name="script_exit_code">0</environment_variable>
    </environment_variables>

     <inputs>
        <param name="genomeinfo" type="data" format="csv" label="Genome Info CSV" />
    </inputs>   

    <outputs>
        <data name="debug_output" format="txt" label="Debug Output test" from_work_dir="debug_files_upload.txt"/>
        <collection name="chromosomes" label="Chromosome files" type="list">
            <discover_datasets pattern="chr*.txt" directory="chromosomes/" format="txt" visible="true"/>
        </collection>
    </outputs>



    <help><![CDATA[
    This tool extracts your input text message and writes a debug log with the executed command and extracted contents.
    ]]></help>
</tool>
